{"version":3,"file":"WalletItem-b742539a.js","sources":["../../src/utils/DragAndDropHelper.ts","../../src/interface/components/WalletItem.tsx"],"sourcesContent":["import { DragEvent as ReactDragEvent, PointerEvent as ReactPointerEvent, StyleHTMLAttributes, useCallback } from \"react\";\n\ntype Effect = DataTransfer[\"dropEffect\"];\n\nexport function useDraggable<E extends HTMLElement, V extends string>(key: string, value: V, effect: Effect, callback: () => void): StyleHTMLAttributes<E> {\n  const draggable = true;\n\n  const onDragStart = useCallback(\n    (event: ReactDragEvent<E>) => {\n      event.preventDefault();\n      event.dataTransfer.setData(key, value);\n      event.dataTransfer.effectAllowed = effect;\n    },\n    [key, value]\n  );\n\n  const onDragEnd = useCallback((event: ReactDragEvent<E>) => {\n    if (event.dataTransfer.types.includes(key) && event.dataTransfer.dropEffect === effect) {\n      event.preventDefault();\n      callback();\n    }\n  }, []);\n\n  return {\n    draggable,\n    onDragStart,\n    onDragEnd,\n  };\n}\n\nexport function useDroppable<E extends Element, V extends string>(key: string, effect: Effect, callback: (value: V) => void) {\n  const onDragEnter = useCallback((event: ReactDragEvent<E>) => {\n    if (event.dataTransfer.types.includes(key)) {\n      event.preventDefault();\n      event.dataTransfer.dropEffect = effect;\n    }\n  }, []);\n\n  const onDragOver = useCallback((event: ReactDragEvent<E>) => {\n    if (event.dataTransfer.types.includes(key)) {\n      event.preventDefault();\n      event.dataTransfer.dropEffect = effect;\n    }\n  }, []);\n\n  const onDrop = useCallback(\n    async (event: ReactDragEvent<E>) => {\n      if (event.dataTransfer.types.includes(key)) {\n        event.preventDefault();\n        callback(event.dataTransfer.getData(key) as V);\n      }\n    },\n    [callback]\n  );\n\n  return { onDragEnter, onDragOver, onDrop };\n}\n\nexport function useDraggableAlt<K extends `data-${string}`, V extends string>(key: string, dataKey: K, value: V, callback: () => void): StyleHTMLAttributes<HTMLElement> {\n  const onPointerDown = useCallback(\n    (event: ReactPointerEvent<HTMLElement>) => {\n      event.preventDefault();\n      const original = event.currentTarget;\n      original.style.opacity = \"0.25\";\n\n      const clone = original.cloneNode() as HTMLElement;\n      clone.style.position = \"fixed\";\n      clone.style.zIndex = \"1000\";\n      clone.style.opacity = \"0.75\";\n\n      original.parentElement?.appendChild(clone);\n      clone.setPointerCapture(event.pointerId);\n\n      // const target = clone.hasPointerCapture(event.pointerId) ? clone : document.body;\n      const target = document.body;\n      const abort = new AbortController();\n\n      target.addEventListener(\n        \"pointermove\",\n        (event: PointerEvent) => {\n          clone.style.left = `${event.x}px`;\n          clone.style.top = `${event.y}px`;\n          clone.style.translate = `-${clone.clientWidth}px -${clone.clientHeight}px`;\n\n          const elements = document.elementsFromPoint(event.x - clone.clientWidth / 2, event.y - clone.clientHeight / 2);\n          const acceptor = elements.find((element) => element.hasAttribute(dataKey));\n          if (acceptor) {\n            clone.style.cursor = \"grabbing\";\n          } else {\n            ``;\n            clone.style.cursor = \"no-drop\";\n          }\n        },\n        abort\n      );\n\n      target.addEventListener(\n        \"pointerup\",\n        (event: PointerEvent) => {\n          original.style.opacity = \"unset\";\n\n          const elements = document.elementsFromPoint(event.x - clone.clientWidth / 2, event.y - clone.clientHeight / 2);\n          const acceptor = elements.find((element) => element.hasAttribute(dataKey));\n          if (acceptor) {\n            const dataTransfer = new DataTransfer();\n            dataTransfer.setData(key, value);\n            const drop = new DragEvent(\"drop\", { dataTransfer, bubbles: true, cancelable: true, composed: true });\n            acceptor.dispatchEvent(drop);\n            callback();\n          }\n\n          clone.remove();\n          abort.abort();\n        },\n        abort\n      );\n    },\n    [callback]\n  );\n\n  return {\n    onPointerDown,\n    style: { touchAction: \"none\" },\n  };\n}\n\nexport function useDroppableAlt<K extends `data-${string}`, V extends string>(key: string, dataKey: K, callback: (value: V) => void): StyleHTMLAttributes<HTMLElement> {\n  const onDrop = useCallback(\n    async (event: ReactDragEvent<HTMLElement>) => {\n      if (event.dataTransfer.types.includes(key)) {\n        event.preventDefault();\n        callback(event.dataTransfer.getData(key) as V);\n      }\n    },\n    [callback]\n  );\n\n  return { onDrop, [dataKey]: true };\n}\n","import \"./WalletItem.css\";\nimport { Money, MoneyLike } from \"@/domain/entities/money\";\nimport { DragEvent as ReactDragEvent, PointerEvent as ReactPointerEvent, StyleHTMLAttributes, useCallback, useState } from \"react\";\nimport { timer } from \"@/utils/PromiseHelper\";\nimport { useDraggableAlt, useDroppableAlt } from \"@/utils/DragAndDropHelper\";\n\nconst MoneyLikeDragDataType = \"text/money-like\";\nconst MoneyLikeAcceptData = \"data-accept-money-like\";\n\nexport type WalletItem = [Symbol, MoneyLike];\n\nexport function WalletItem({ item, onTakeOut }: { item: WalletItem; onTakeOut: (item: WalletItem) => void }) {\n  const [_, moneyLike] = item;\n\n  const onDragEnd = useCallback(() => onTakeOut(item), [onTakeOut, item]);\n  const handlers = useDraggableAlt(MoneyLikeDragDataType, MoneyLikeAcceptData, moneyLike, onDragEnd);\n\n  // prettier-ignore\n  const className = \n    moneyLike.includes(\"玉\") ? \"WalletItem--coin\" :\n    moneyLike.includes(\"札\") ? \"WalletItem--bill\" :\n    \"WalletItem--unknown\";\n\n  return (\n    <div className={className} title={moneyLike} {...handlers}>\n      <span style={{ visibility: \"hidden\" }}>{moneyLike}</span>\n    </div>\n  );\n}\n\nexport function useWalletItemDroppable(callback: (moneyLike: MoneyLike) => void) {\n  return useDroppableAlt(MoneyLikeDragDataType, MoneyLikeAcceptData, callback);\n}\n"],"names":["useDraggableAlt","key","dataKey","value","callback","useCallback","event","original","clone","_a","target","abort","element","acceptor","dataTransfer","drop","__name","useDroppableAlt","MoneyLikeDragDataType","MoneyLikeAcceptData","WalletItem","item","onTakeOut","_","moneyLike","onDragEnd","handlers","className","jsx","useWalletItemDroppable"],"mappings":"qKA0DO,SAASA,EAA8DC,EAAaC,EAAYC,EAAUC,EAAwD,CA8DhK,MAAA,CACL,cA9DoBC,EAAA,YACnBC,GAA0C,OACzCA,EAAM,eAAe,EACrB,MAAMC,EAAWD,EAAM,cACvBC,EAAS,MAAM,QAAU,OAEnB,MAAAC,EAAQD,EAAS,YACvBC,EAAM,MAAM,SAAW,QACvBA,EAAM,MAAM,OAAS,OACrBA,EAAM,MAAM,QAAU,QAEbC,EAAAF,EAAA,gBAAA,MAAAE,EAAe,YAAYD,GAC9BA,EAAA,kBAAkBF,EAAM,SAAS,EAGvC,MAAMI,EAAS,SAAS,KAClBC,EAAQ,IAAI,gBAEXD,EAAA,iBACL,cACCJ,GAAwB,CACjBE,EAAA,MAAM,KAAO,GAAGF,EAAM,MACtBE,EAAA,MAAM,IAAM,GAAGF,EAAM,MAC3BE,EAAM,MAAM,UAAY,IAAIA,EAAM,kBAAkBA,EAAM,iBAEzC,SAAS,kBAAkBF,EAAM,EAAIE,EAAM,YAAc,EAAGF,EAAM,EAAIE,EAAM,aAAe,CAAC,EACnF,KAAMI,GAAYA,EAAQ,aAAaV,CAAO,CAAC,EAEvEM,EAAM,MAAM,OAAS,WAGrBA,EAAM,MAAM,OAAS,SAEzB,EACAG,CAAA,EAGKD,EAAA,iBACL,YACCJ,GAAwB,CACvBC,EAAS,MAAM,QAAU,QAGnB,MAAAM,EADW,SAAS,kBAAkBP,EAAM,EAAIE,EAAM,YAAc,EAAGF,EAAM,EAAIE,EAAM,aAAe,CAAC,EACnF,KAAMI,GAAYA,EAAQ,aAAaV,CAAO,CAAC,EACzE,GAAIW,EAAU,CACN,MAAAC,EAAe,IAAI,aACZA,EAAA,QAAQb,EAAKE,CAAK,EAC/B,MAAMY,EAAO,IAAI,UAAU,OAAQ,CAAE,aAAAD,EAAc,QAAS,GAAM,WAAY,GAAM,SAAU,EAAM,CAAA,EACpGD,EAAS,cAAcE,CAAI,EAClBX,GACX,CAEAI,EAAM,OAAO,EACbG,EAAM,MAAM,CACd,EACAA,CAAA,CAEJ,EACA,CAACP,CAAQ,CAAA,EAKT,MAAO,CAAE,YAAa,MAAO,CAAA,CAEjC,CAlEgBY,EAAAhB,EAAA,mBAoEA,SAAAiB,EAA8DhB,EAAaC,EAAYE,EAAgE,CAWrK,MAAO,CAAE,OAVMC,EAAA,YACb,MAAOC,GAAuC,CACxCA,EAAM,aAAa,MAAM,SAASL,CAAG,IACvCK,EAAM,eAAe,EACrBF,EAASE,EAAM,aAAa,QAAQL,CAAG,CAAM,EAEjD,EACA,CAACG,CAAQ,CAAA,EAGM,CAACF,CAAO,EAAG,EAAK,CACnC,CAZgBc,EAAAC,EAAA,mBCxHhB,MAAAC,EAAA,kBACAC,EAAA,yBAIO,SAAAC,EAAA,CAAA,KAAAC,EAAA,UAAAC,GAAA,CACL,KAAA,CAAAC,EAAAC,CAAA,EAAAH,EAEAI,EAAApB,EAAA,YAAA,IAAAiB,EAAAD,CAAA,EAAA,CAAAC,EAAAD,CAAA,CAAA,EACAK,EAAA1B,EAAAkB,EAAAC,EAAAK,EAAAC,CAAA,EAGAE,EAAAH,EAAA,SAAA,GAAA,EAAA,mBAAAA,EAAA,SAAA,GAAA,EAAA,mBAAA,sBAKA,OAAAI,EAAA,IAAA,MAAA,CAAA,UAAAD,EAAA,MAAAH,EAAA,GAAAE,EAAA,SAAAE,EAAAA,IAAA,OAAA,CAAA,MAAA,CAAA,WAAA,QAAA,EAAA,SAAAJ,EAAA,CAAA,CAAA,CAKF,CAjBOR,EAAAI,EAAA,cAmBA,SAAAS,EAAAzB,EAAA,CACL,OAAAa,EAAAC,EAAAC,EAAAf,CAAA,CACF,CAFOY,EAAAa,EAAA"}